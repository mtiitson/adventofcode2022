const input = `493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
490,34 -> 494,34
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
493,32 -> 497,32
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
458,132 -> 463,132
473,38 -> 487,38
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
482,76 -> 486,76
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
490,26 -> 494,26
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
469,171 -> 473,171
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
487,32 -> 491,32
472,168 -> 476,168
496,30 -> 500,30
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
459,151 -> 459,152 -> 468,152 -> 468,151
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
459,151 -> 459,152 -> 468,152 -> 468,151
496,34 -> 500,34
484,30 -> 488,30
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
451,132 -> 456,132
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
490,30 -> 494,30
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
461,129 -> 466,129
472,72 -> 472,73 -> 483,73 -> 483,72
481,32 -> 485,32
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
476,82 -> 480,82
454,129 -> 459,129
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
488,82 -> 492,82
487,28 -> 491,28
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
473,54 -> 481,54 -> 481,53
485,79 -> 489,79
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
479,85 -> 483,85
463,177 -> 467,177
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
462,135 -> 467,135
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
472,174 -> 476,174
469,135 -> 474,135
478,34 -> 482,34
479,79 -> 483,79
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
465,132 -> 470,132
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
448,135 -> 453,135
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
482,82 -> 486,82
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
484,34 -> 488,34
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
473,54 -> 481,54 -> 481,53
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
457,126 -> 462,126
475,177 -> 479,177
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
478,174 -> 482,174
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
472,72 -> 472,73 -> 483,73 -> 483,72
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
499,32 -> 503,32
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
481,177 -> 485,177
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
455,135 -> 460,135
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
472,72 -> 472,73 -> 483,73 -> 483,72
463,67 -> 463,57 -> 463,67 -> 465,67 -> 465,64 -> 465,67 -> 467,67 -> 467,64 -> 467,67 -> 469,67 -> 469,57 -> 469,67 -> 471,67 -> 471,62 -> 471,67 -> 473,67 -> 473,57 -> 473,67 -> 475,67 -> 475,65 -> 475,67 -> 477,67 -> 477,57 -> 477,67 -> 479,67 -> 479,58 -> 479,67
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
502,34 -> 506,34
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
485,85 -> 489,85
475,171 -> 479,171
459,151 -> 459,152 -> 468,152 -> 468,151
491,85 -> 495,85
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
469,51 -> 469,42 -> 469,51 -> 471,51 -> 471,42 -> 471,51 -> 473,51 -> 473,43 -> 473,51
463,165 -> 463,160 -> 463,165 -> 465,165 -> 465,156 -> 465,165 -> 467,165 -> 467,159 -> 467,165 -> 469,165 -> 469,157 -> 469,165 -> 471,165 -> 471,163 -> 471,165 -> 473,165 -> 473,156 -> 473,165
465,101 -> 465,103 -> 458,103 -> 458,111 -> 477,111 -> 477,103 -> 469,103 -> 469,101
470,88 -> 470,92 -> 469,92 -> 469,98 -> 483,98 -> 483,92 -> 475,92 -> 475,88
493,28 -> 497,28
473,85 -> 477,85
493,23 -> 493,20 -> 493,23 -> 495,23 -> 495,22 -> 495,23 -> 497,23 -> 497,13 -> 497,23 -> 499,23 -> 499,21 -> 499,23 -> 501,23 -> 501,20 -> 501,23 -> 503,23 -> 503,13 -> 503,23 -> 505,23 -> 505,16 -> 505,23
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
455,114 -> 455,118 -> 451,118 -> 451,123 -> 459,123 -> 459,118 -> 458,118 -> 458,114
469,177 -> 473,177
451,138 -> 451,141 -> 444,141 -> 444,147 -> 463,147 -> 463,141 -> 455,141 -> 455,138
466,174 -> 470,174`.split('\n').map(row => row.split(' -> ').map(pair => pair.split(',').map(Number)));

const maxX = Math.max(...input.flatMap(row => row.map(pair => pair[0]))) + 1000; // Part 2: extend the rock bottom by safe margin
const maxY = Math.max(...input.flatMap(row => row.map(pair => pair[1]))) + 3; // Part 2: add 2 more rows

const rows = [...new Array(maxY)].map(_ => [...new Array(maxX + 1)].map(_ => ({})));

const cols = rows[0].map((_, i) => rows.map(row => row[i]));

const range = (start, stop) => Array.from({length: Math.abs(stop - start) + 1}, (_, i) => Math.min(start, stop) + i);

rows[rows.length - 1].forEach(t => t.rock = 1); // Part 2: set the last row as rocks

input.forEach(row => {
    row.slice(1).reduce(([x0, y0], [x1, y1]) => {
        range(x0, x1).forEach(x => cols[x][y0].rock = 1);
        range(y0, y1).forEach(y => rows[y][x0].rock = 1);
        return [x1, y1];
    }, row[0])
});

let fin = 0;
const drop = (x, y) => {
    if (cols[x][y].rock || cols[x][y].sand) return 0;
    const blocked = cols[x].slice(y).findIndex(t => t.rock || t.sand) + y;
    if (blocked < y) return fin++;
    if (drop(x - 1, blocked) || drop(x + 1, blocked)) return 1;
    if (fin) return 0;
    cols[x][blocked - 1].sand = true;
    return 1;
};


while (drop(500, 0)) {
}
const res = rows.flatMap(row => row).filter(t => t.sand).length;
console.log(res);
